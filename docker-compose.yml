services:  # Aqu√≠ se definen todos los contenedores del proyecto.



  ### üü¢ BACKEND SERVICE ###
  backend:
    build: ./backend  # Construye la imagen desde el Dockerfile en ./backend
    container_name: sgalt-backend  # Nombre personalizado del contenedor
    ports:
      - "4000:4000"  # Expone el puerto 3000 del contenedor al 3000 del host
    depends_on:
      - db  # Este servicio espera que 'db' (PostgreSQL) est√© iniciado
    environment:
      - PORT=4000  # Puerto en el que corre el backend dentro del contenedor
      - DB_HOST=db  # Nombre del servicio (host) de PostgreSQL en esta red
      - DB_PORT=5432
      - DB_USER=postgres
      - DB_PASSWORD=postgres
      - DB_NAME=sgalt
    volumes:
      - ./backend:/app  # Sincroniza los archivos del backend al contenedor
    networks:
      - sgalt-network  # Lo conecta a una red interna personalizada



  ### üîµ FRONTEND SERVICE ###
  frontend:
    build: ./frontend  # Construye la imagen desde el Dockerfile en ./frontend
    container_name: sgalt-frontend
    ports:
      - "5173:5173"  # Vite usa el puerto 5173 por defecto
    volumes:
      - ./frontend:/app  # Sincroniza archivos locales con el contenedor
      - /app/node_modules
    depends_on:
      - backend  # Espera que el backend est√© arriba
    networks:
      - sgalt-network



  ### üü£ POSTGRES DATABASE SERVICE ###
  db:
    image: postgres:16
    container_name: sgalt-db
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: sgalt
      TZ: America/Santiago
    ports:
      - "5432:5432"
    volumes:
      - db_data:/var/lib/postgresql/data
      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql  # ‚Üê solo estructura
    networks:
      - sgalt-network



# Define la red interna personalizada para que todos los servicios se comuniquen entre s√≠
networks:
  sgalt-network:
    driver: bridge

# Define un volumen persistente para la base de datos
volumes:
  db_data:
